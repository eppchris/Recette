{% extends 'base.html' %}

{% block breadcrumb %}{{ S('all') }}{% endblock %}

{% block content %}

<script>
  // Donn√©es des recettes pour Alpine
  window.recipesData = {{ rows | tojson | safe }};
</script>

<div x-data="{
  search: '',
  sortBy: 'name',
  sortOrder: 'asc',
  recipes: window.recipesData || [],
  get filteredRecipes() {
    let filtered = this.recipes.filter(r => 
      this.search === '' || r.name.toLowerCase().includes(this.search.toLowerCase())
    );
    return filtered.sort((a, b) => {
      let aVal = a[this.sortBy] || '';
      let bVal = b[this.sortBy] || '';
      if (this.sortBy === 'servings') {
        aVal = parseInt(aVal) || 0;
        bVal = parseInt(bVal) || 0;
      }
      if (this.sortOrder === 'asc') {
        return aVal > bVal ? 1 : -1;
      } else {
        return aVal < bVal ? 1 : -1;
      }
    });
  },
  sort(column) {
    if (this.sortBy === column) {
      this.sortOrder = this.sortOrder === 'asc' ? 'desc' : 'asc';
    } else {
      this.sortBy = column;
      this.sortOrder = 'asc';
    }
  }
}">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold">{{ S('all') }}</h1>
    <a href="/import?lang={{ lang }}" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
      {{ S('import') }}
    </a>
  </div>

  <!-- Barre de recherche -->
  <div class="mb-4">
    <input 
      type="text" 
      x-model="search"
      placeholder="üîç Rechercher une recette..."
      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
    >
  </div>

  <div class="bg-white rounded-lg border overflow-hidden">
    <table class="w-full text-sm">
      <thead class="bg-gray-100 border-b">
        <tr>
          <th @click="sort('name')" class="p-3 text-left cursor-pointer hover:bg-gray-200 select-none">
            <div class="flex items-center gap-2">
              <span>{{ S('recipes') }}</span>
              <span class="text-xs" x-show="sortBy === 'name'">
                <span x-show="sortOrder === 'asc'">‚ñ≤</span>
                <span x-show="sortOrder === 'desc'">‚ñº</span>
              </span>
            </div>
          </th>
          <th @click="sort('type')" class="p-3 text-center cursor-pointer hover:bg-gray-200 select-none">
            <div class="flex items-center justify-center gap-2">
              <span>{{ S('type') }}</span>
              <span class="text-xs" x-show="sortBy === 'type'">
                <span x-show="sortOrder === 'asc'">‚ñ≤</span>
                <span x-show="sortOrder === 'desc'">‚ñº</span>
              </span>
            </div>
          </th>
          <th @click="sort('servings')" class="p-3 text-center cursor-pointer hover:bg-gray-200 select-none">
            <div class="flex items-center justify-center gap-2">
              <span>{{ S('servings') }}</span>
              <span class="text-xs" x-show="sortBy === 'servings'">
                <span x-show="sortOrder === 'asc'">‚ñ≤</span>
                <span x-show="sortOrder === 'desc'">‚ñº</span>
              </span>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        <template x-for="r in filteredRecipes" :key="r.id">
          <tr class="border-t hover:bg-gray-50 transition">
            <td class="p-3">
              <a :href="`/recipe/${r.slug}?lang={{ lang }}`" class="text-blue-700 hover:underline" x-text="r.name"></a>
            </td>
            <td class="p-3 text-center" x-text="r.type || '-'"></td>
            <td class="p-3 text-center" x-text="r.servings || '-'"></td>
          </tr>
        </template>
        
        <tr x-show="filteredRecipes.length === 0">
          <td colspan="3" class="p-8 text-center text-gray-500">
            <div class="text-4xl mb-2">üîç</div>
            <div>Aucune recette trouv√©e</div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  {% if not rows %}
  <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded text-sm">
    Aucune recette trouv√©e. <a href="/import?lang={{ lang }}" class="text-blue-700 underline">Importez-en une !</a>
  </div>
  {% endif %}
</div>
{% endblock %}