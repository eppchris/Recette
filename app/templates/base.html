<!DOCTYPE html>
<html lang="{{ 'jp' if lang=='jp' else 'fr' }}" x-data="{ darkMode: false, sidebarOpen: true, recipesOpen: true, gestionOpen: false, parametrageOpen: false }" :class="{ 'dark': darkMode }">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ S('recipes') }}</title>
  <script src="/static/css/tailwind.min.js"></script>
  <script defer src="/static/css/alpine.min.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
    }
  </script>
  <style>
    [x-cloak] { display: none !important; }
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200">
  
  <!-- Sidebar -->
  <aside 
    :class="sidebarOpen ? 'w-64' : 'w-20'" 
    class="fixed left-0 top-0 h-screen bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 transition-all duration-300 z-50"
  >
    <!-- Header -->
    <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
      <div x-show="sidebarOpen" x-transition class="flex items-center gap-2">
        <span class="text-2xl">ğŸ³</span>
        <span class="font-bold text-lg">Recette App</span>
      </div>
      <span x-show="!sidebarOpen" class="text-2xl mx-auto">ğŸ³</span>
      <button 
        @click="sidebarOpen = !sidebarOpen"
        class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition"
        :class="!sidebarOpen && 'hidden'"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/>
        </svg>
      </button>
    </div>

    <!-- Navigation -->
    <nav class="p-4 space-y-2 pb-96">
      <!-- Section Recettes -->
      <div>
        <button
          @click="recipesOpen = !recipesOpen"
          class="w-full flex items-center justify-between gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition group"
          :class="'{{ request.path }}'.includes('/recipe') && 'bg-blue-50 dark:bg-blue-900 text-blue-600 dark:text-blue-300'"
        >
          <div class="flex items-center gap-3">
            <span class="text-xl">ğŸ“–</span>
            <span x-show="sidebarOpen" x-transition class="font-medium">{{ S('menu_recipes') }}</span>
          </div>
          <span x-show="sidebarOpen" x-transition class="text-gray-400" x-text="recipesOpen ? 'â–¼' : 'â–¶'"></span>
        </button>
        <div x-show="sidebarOpen && recipesOpen" x-transition class="ml-11 mt-1 space-y-1">
          <a href="/recipes?lang={{ lang }}" class="block px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 rounded">
            {{ S('all_recipes') }}
          </a>
          <a href="/import?lang={{ lang }}" class="block px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 rounded">
            {{ S('import_recipe') }}
          </a>
        </div>
      </div>

      <!-- Section Ã‰vÃ©nements -->
      <div>
        <a
          href="/events?lang={{ lang }}"
          class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition group"
          :class="'{{ request.path }}'.includes('/event') && 'bg-blue-50 dark:bg-blue-900 text-blue-600 dark:text-blue-300'"
        >
          <span class="text-xl">ğŸ“…</span>
          <span x-show="sidebarOpen" x-transition class="font-medium">{{ S('menu_events') }}</span>
        </a>
      </div>

      <!-- Section Gestion -->
      <div>
        <button
          @click="gestionOpen = !gestionOpen"
          class="w-full flex items-center justify-between gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition group"
          :class="('{{ request.path }}'.includes('/ingredient-catalog') || '{{ request.path }}'.includes('/unit-conversions') || '{{ request.path }}'.includes('/ingredient-specific-conversions')) && 'bg-blue-50 dark:bg-blue-900 text-blue-600 dark:text-blue-300'"
        >
          <div class="flex items-center gap-3">
            <span class="text-xl">ğŸ“Š</span>
            <span x-show="sidebarOpen" x-transition class="font-medium">{{ S('menu_settings') }}</span>
          </div>
          <span x-show="sidebarOpen" x-transition class="text-gray-400" x-text="gestionOpen ? 'â–¼' : 'â–¶'"></span>
        </button>
        <div x-show="sidebarOpen && gestionOpen" x-transition class="ml-11 mt-1 space-y-1">
          <a href="/ingredient-catalog?lang={{ lang }}" class="block px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 rounded">
            {{ 'Catalogue des prix' if lang == 'fr' else 'ä¾¡æ ¼ã‚«ã‚¿ãƒ­ã‚°' }}
          </a>
          <a href="/unit-conversions?lang={{ lang }}" class="block px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 rounded">
            {{ 'Conversions d\'unitÃ©s' if lang == 'fr' else 'å˜ä½å¤‰æ›' }}
          </a>
          <a href="/ingredient-specific-conversions?lang={{ lang }}" class="block px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 rounded">
            {{ 'Conversions spÃ©cifiques' if lang == 'fr' else 'é£Ÿæåˆ¥å¤‰æ›' }}
          </a>
        </div>
      </div>

      <!-- Section ParamÃ©trage -->
      <div>
        <button
          @click="parametrageOpen = !parametrageOpen"
          class="w-full flex items-center justify-between gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition group"
          :class="('{{ request.path }}'.includes('/admin/tags') || '{{ request.path }}'.includes('/access-logs') || '{{ request.path }}'.includes('/admin/users')) && 'bg-blue-50 dark:bg-blue-900 text-blue-600 dark:text-blue-300'"
        >
          <div class="flex items-center gap-3">
            <span class="text-xl">âš™ï¸</span>
            <span x-show="sidebarOpen" x-transition class="font-medium">{{ 'ParamÃ©trage' if lang == 'fr' else 'è¨­å®š' }}</span>
          </div>
          <span x-show="sidebarOpen" x-transition class="text-gray-400" x-text="parametrageOpen ? 'â–¼' : 'â–¶'"></span>
        </button>
        <div x-show="sidebarOpen && parametrageOpen" x-transition class="ml-11 mt-1 space-y-1">
          <a href="/admin/tags?lang={{ lang }}" class="block px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 rounded">
            {{ 'Tags et catÃ©gories' if lang == 'fr' else 'ã‚¿ã‚°ã¨ã‚«ãƒ†ã‚´ãƒªãƒ¼' }}
          </a>
          <a href="/access-logs?lang={{ lang }}" class="block px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 rounded">
            {{ 'Logs d\'accÃ¨s' if lang == 'fr' else 'ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°' }}
          </a>
          <a href="/admin/users?lang={{ lang }}" class="block px-3 py-1.5 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100 rounded">
            {{ 'Gestion des utilisateurs' if lang == 'fr' else 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†' }}
          </a>
        </div>
      </div>
    </nav>

    <!-- Footer Sidebar -->
    <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200 dark:border-gray-700 space-y-2">
      <!-- User info -->
      {% if request.session.get('authenticated') %}
      <a
        href="/profile?lang={{ lang }}"
        class="w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition"
      >
        <span class="text-xl">ğŸ‘¤</span>
        <div x-show="sidebarOpen" x-transition class="flex-1 min-w-0">
          <div class="text-sm font-medium truncate">{{ request.session.get('username', 'User') }}</div>
          {% if request.session.get('is_admin') %}
          <div class="text-xs text-purple-600 dark:text-purple-400">â­ Admin</div>
          {% endif %}
        </div>
      </a>

      <!-- Logout button -->
      <a
        href="/logout?lang={{ lang }}"
        class="w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400 transition"
      >
        <span class="text-xl">ğŸšª</span>
        <span x-show="sidebarOpen" x-transition class="text-sm font-medium">
          {{ 'DÃ©connexion' if lang == 'fr' else 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ' }}
        </span>
      </a>

      <div x-show="sidebarOpen" x-transition class="border-t border-gray-200 dark:border-gray-700 my-2"></div>
      {% endif %}

      <!-- Aide -->
      <a
        href="/help?lang={{ lang }}"
        class="w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition"
      >
        <span class="text-xl">â“</span>
        <span x-show="sidebarOpen" x-transition class="text-sm font-medium">
          {{ 'Aide' if lang == 'fr' else 'ãƒ˜ãƒ«ãƒ—' }}
        </span>
      </a>

      <!-- Toggle mode sombre -->
      <button
        @click="darkMode = !darkMode"
        class="w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition"
      >
        <span class="text-xl" x-text="darkMode ? 'â˜€ï¸' : 'ğŸŒ™'"></span>
        <span x-show="sidebarOpen" x-transition class="text-sm" x-text="darkMode ? '{{ S('light_mode') }}' : '{{ S('dark_mode') }}'"></span>
      </button>

      <!-- SÃ©lecteur de langue -->
      <div x-show="sidebarOpen" x-transition class="flex gap-2 px-3">
        <a
          href="?lang=fr"
          class="flex-1 text-center py-1.5 text-sm rounded {{ 'font-bold bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300' if lang=='fr' else 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700' }}"
        >
          FR
        </a>
        <a
          href="?lang=jp"
          class="flex-1 text-center py-1.5 text-sm rounded {{ 'font-bold bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300' if lang=='jp' else 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700' }}"
        >
          JP
        </a>
      </div>
    </div>

    <!-- Bouton pour rouvrir sidebar quand fermÃ©e -->
    <button 
      x-show="!sidebarOpen"
      @click="sidebarOpen = true"
      class="absolute -right-3 top-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-full p-1 hover:bg-gray-100 dark:hover:bg-gray-700 transition"
    >
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"/>
      </svg>
    </button>
  </aside>

  <!-- Main Content -->
  <main 
    :class="sidebarOpen ? 'ml-64' : 'ml-20'" 
    class="min-h-screen transition-all duration-300 p-6"
  >
    <!-- Breadcrumb -->
    <div class="mb-6 text-sm text-gray-600 dark:text-gray-400">
      <span>{{ S('recipes') }}</span>
      <span class="mx-2">â€º</span>
      <span class="text-gray-900 dark:text-gray-100">{% block breadcrumb %}{{ S('all') }}{% endblock %}</span>
    </div>

    <!-- Contenu de la page -->
    <div class="max-w-7xl">
      {% block content %}{% endblock %}
    </div>
  </main>

</body>
</html>