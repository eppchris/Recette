{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto">
  <!-- Header -->
  <div class="mb-8 flex justify-between items-center">
    <div>
      <h1 class="text-3xl font-bold mb-2">
        {% if lang == 'fr' %}
          Ã‰diter l'aide
        {% else %}
          ãƒ˜ãƒ«ãƒ—ã‚’ç·¨é›†
        {% endif %}
      </h1>
      <p class="text-gray-600 dark:text-gray-400">
        {% if lang == 'fr' %}
          Modifiez le contenu de la page d'aide (format Markdown)
        {% else %}
          ãƒ˜ãƒ«ãƒ—ãƒšãƒ¼ã‚¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç·¨é›†ï¼ˆMarkdownå½¢å¼ï¼‰
        {% endif %}
      </p>
    </div>
    <a href="/help?lang={{ lang }}" class="flex items-center gap-2 px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-lg transition">
      <span>â†</span>
      <span>{% if lang == 'fr' %}Retour Ã  l'aide{% else %}ãƒ˜ãƒ«ãƒ—ã«æˆ»ã‚‹{% endif %}</span>
    </a>
  </div>

  <!-- Messages -->
  {% if success %}
  <div class="mb-6 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg text-green-600 dark:text-green-400">
    {{ success }}
  </div>
  {% endif %}

  {% if error %}
  <div class="mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg text-red-600 dark:text-red-400">
    {{ error }}
  </div>
  {% endif %}

  <!-- Info Markdown -->
  <div class="mb-6 p-4 bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 rounded-lg">
    <p class="font-semibold mb-2">
      {% if lang == 'fr' %}
        ğŸ’¡ Syntaxe Markdown
      {% else %}
        ğŸ’¡ Markdownæ§‹æ–‡
      {% endif %}
    </p>
    <div class="text-sm text-gray-700 dark:text-gray-300 space-y-1">
      {% if lang == 'fr' %}
      <p><code># Titre</code> â†’ Titre niveau 1</p>
      <p><code>## Sous-titre</code> â†’ Titre niveau 2</p>
      <p><code>**texte**</code> â†’ <strong>gras</strong></p>
      <p><code>- item</code> â†’ Liste Ã  puces</p>
      <p><code>1. item</code> â†’ Liste numÃ©rotÃ©e</p>
      <p><code>`code`</code> â†’ Code en ligne</p>
      {% else %}
      <p><code># ã‚¿ã‚¤ãƒˆãƒ«</code> â†’ ãƒ¬ãƒ™ãƒ«1ã®ã‚¿ã‚¤ãƒˆãƒ«</p>
      <p><code>## ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«</code> â†’ ãƒ¬ãƒ™ãƒ«2ã®ã‚¿ã‚¤ãƒˆãƒ«</p>
      <p><code>**ãƒ†ã‚­ã‚¹ãƒˆ**</code> â†’ <strong>å¤ªå­—</strong></p>
      <p><code>- é …ç›®</code> â†’ ç®‡æ¡æ›¸ã</p>
      <p><code>1. é …ç›®</code> â†’ ç•ªå·ä»˜ããƒªã‚¹ãƒˆ</p>
      <p><code>`ã‚³ãƒ¼ãƒ‰`</code> â†’ ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰</p>
      {% endif %}
    </div>
  </div>

  <!-- Formulaire -->
  <form method="post" action="/admin/help/edit?lang={{ lang }}" x-data="{ showPreview: false }">

    <!-- Onglets -->
    <div class="mb-4 flex gap-2">
      <button
        type="button"
        @click="showPreview = false"
        :class="!showPreview ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
        class="px-4 py-2 rounded-lg transition"
      >
        {% if lang == 'fr' %}âœï¸ Ã‰dition{% else %}âœï¸ ç·¨é›†{% endif %}
      </button>
      <button
        type="button"
        @click="showPreview = true"
        :class="showPreview ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
        class="px-4 py-2 rounded-lg transition"
      >
        {% if lang == 'fr' %}ğŸ‘ï¸ AperÃ§u{% else %}ğŸ‘ï¸ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼{% endif %}
      </button>
    </div>

    <!-- Zone d'Ã©dition -->
    <div x-show="!showPreview" class="mb-6">
      <textarea
        name="content"
        rows="30"
        class="w-full px-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm"
        placeholder="{{ 'Contenu de l\'aide en Markdown...' if lang == 'fr' else 'Markdownã§ãƒ˜ãƒ«ãƒ—ã‚³ãƒ³ãƒ†ãƒ³ãƒ„...' }}"
      >{{ content }}</textarea>
    </div>

    <!-- AperÃ§u -->
    <div x-show="showPreview" class="mb-6">
      <div class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg p-6 prose dark:prose-invert max-w-none min-h-[500px]">
        {{ preview_html | safe }}
      </div>
    </div>

    <!-- Boutons d'action -->
    <div class="flex gap-4">
      <button
        type="submit"
        class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition"
      >
        {% if lang == 'fr' %}ğŸ’¾ Enregistrer{% else %}ğŸ’¾ ä¿å­˜{% endif %}
      </button>
      <a
        href="/help?lang={{ lang }}"
        class="bg-gray-300 dark:bg-gray-700 hover:bg-gray-400 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-6 py-3 rounded-lg font-semibold transition"
      >
        {% if lang == 'fr' %}âŒ Annuler{% else %}âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«{% endif %}
      </a>
    </div>

  </form>

</div>

<style>
/* Styles pour le markdown rendu */
.prose h1 { font-size: 2em; font-weight: bold; margin-top: 1em; margin-bottom: 0.5em; }
.prose h2 { font-size: 1.5em; font-weight: bold; margin-top: 1em; margin-bottom: 0.5em; }
.prose h3 { font-size: 1.25em; font-weight: 600; margin-top: 0.75em; margin-bottom: 0.5em; }
.prose p { margin-bottom: 1em; line-height: 1.7; }
.prose ul, .prose ol { margin-left: 2em; margin-bottom: 1em; }
.prose li { margin-bottom: 0.5em; }
.prose code { background-color: rgba(0,0,0,0.05); padding: 2px 6px; border-radius: 3px; font-family: monospace; }
.prose pre { background-color: rgba(0,0,0,0.05); padding: 1em; border-radius: 6px; overflow-x: auto; }
.prose blockquote { border-left: 4px solid #ccc; padding-left: 1em; margin-left: 0; color: #666; }
.prose strong { font-weight: 600; }
.prose em { font-style: italic; }
.prose hr { border: 0; border-top: 1px solid #ccc; margin: 2em 0; }

/* Dark mode */
.dark .prose { color: #e5e7eb; }
.dark .prose h1, .dark .prose h2, .dark .prose h3 { color: #f9fafb; }
.dark .prose code { background-color: rgba(255,255,255,0.1); }
.dark .prose pre { background-color: rgba(255,255,255,0.05); }
.dark .prose blockquote { border-left-color: #4b5563; color: #9ca3af; }
</style>

{% endblock %}
