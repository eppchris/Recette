<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ 'Upload ticket de caisse' if lang == 'fr' else 'ãƒ¬ã‚·ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰' }} - Recette</title>

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico?v=2">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png?v=2">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png?v=2">
    <link rel="apple-touch-icon" sizes="64x64" href="/static/favicon-64x64.png?v=2">
    <script src="/static/css/tailwind.min.js"></script>
    <script defer src="/static/css/alpine.min.js"></script>
</head>
<body class="bg-gray-50" x-data="{ darkMode: false, uploading: false }">
    <div :class="darkMode ? 'dark bg-gray-900' : 'bg-gray-50'" class="min-h-screen">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
            <div class="max-w-4xl mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-4">
                        <a href="/receipt-list?lang={{ lang }}" class="text-blue-600 dark:text-blue-400 hover:underline">
                            â† {{ 'Retour Ã  la liste' if lang == 'fr' else 'ãƒªã‚¹ãƒˆã«æˆ»ã‚‹' }}
                        </a>
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
                            ğŸ“¤ {{ 'Upload ticket de caisse' if lang == 'fr' else 'ãƒ¬ã‚·ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰' }}
                        </h1>
                    </div>

                    <div class="flex items-center gap-4">
                        <!-- SÃ©lecteur de langue -->
                        <div class="flex gap-2">
                            <a href="?lang=fr"
                               class="px-3 py-1.5 rounded-lg {{ 'bg-blue-500 text-white' if lang == 'fr' else 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600' }}">
                                FR
                            </a>
                            <a href="?lang=jp"
                               class="px-3 py-1.5 rounded-lg {{ 'bg-blue-500 text-white' if lang == 'jp' else 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600' }}">
                                JP
                            </a>
                        </div>

                        <!-- Toggle mode sombre -->
                        <button @click="darkMode = !darkMode"
                                class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">
                            <span x-show="!darkMode">ğŸŒ™</span>
                            <span x-show="darkMode">â˜€ï¸</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Contenu principal -->
        <main class="max-w-4xl mx-auto px-4 py-8">
            <!-- Message d'erreur -->
            {% if error %}
            <div class="mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
                <div class="flex items-start gap-3">
                    <span class="text-2xl">âš ï¸</span>
                    <div>
                        <h3 class="font-semibold text-red-800 dark:text-red-200 mb-1">
                            {{ 'Erreur' if lang == 'fr' else 'ã‚¨ãƒ©ãƒ¼' }}
                        </h3>
                        <p class="text-red-700 dark:text-red-300">{{ error }}</p>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Formulaire d'upload -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow">
                <form method="POST" action="/receipt-upload" enctype="multipart/form-data"
                      @submit="uploading = true"
                      class="p-6 space-y-6">
                    <input type="hidden" name="lang" value="{{ lang }}">

                    <!-- Nom du ticket (optionnel) -->
                    <div>
                        <label for="receipt_name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            {{ 'Nom du ticket (optionnel)' if lang == 'fr' else 'ãƒ¬ã‚·ãƒ¼ãƒˆåï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰' }}
                        </label>
                        <input type="text"
                               id="receipt_name"
                               name="receipt_name"
                               placeholder="{{ 'Ex: Courses du 6 janvier 2026' if lang == 'fr' else 'ä¾‹ï¼š2026å¹´1æœˆ6æ—¥ã®è²·ã„ç‰©' }}"
                               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
                            {{ 'Donnez un nom personnalisÃ© Ã  ce ticket pour le retrouver facilement' if lang == 'fr' else 'ã“ã®ãƒ¬ã‚·ãƒ¼ãƒˆã«ç‹¬è‡ªã®åå‰ã‚’ä»˜ã‘ã¦ç°¡å˜ã«è¦‹ã¤ã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™' }}
                        </p>
                    </div>

                    <!-- SÃ©lection du fichier PDF -->
                    <div>
                        <label for="pdf_file" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            {{ 'Ticket de caisse PDF' if lang == 'fr' else 'ãƒ¬ã‚·ãƒ¼ãƒˆPDF' }} *
                        </label>
                        <input type="file"
                               id="pdf_file"
                               name="pdf_file"
                               accept="application/pdf"
                               required
                               class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white
                                      file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold
                                      file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100
                                      dark:file:bg-blue-900 dark:file:text-blue-300">
                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
                            {{ 'Format acceptÃ© : PDF uniquement' if lang == 'fr' else 'å¯¾å¿œãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼šPDFã®ã¿' }}
                        </p>
                    </div>

                    <!-- Instructions -->
                    <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
                        <h3 class="font-semibold text-blue-900 dark:text-blue-200 mb-2">
                            â„¹ï¸ {{ 'Comment Ã§a marche ?' if lang == 'fr' else 'ä½¿ã„æ–¹' }}
                        </h3>
                        <ol class="text-sm text-blue-800 dark:text-blue-300 space-y-2 list-decimal list-inside">
                            <li>{{ 'Uploadez votre ticket de caisse en PDF' if lang == 'fr' else 'PDFãƒ¬ã‚·ãƒ¼ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰' }}</li>
                            <li>{{ 'L\'application extrait automatiquement les articles et leurs prix' if lang == 'fr' else 'ã‚¢ãƒ—ãƒªãŒè‡ªå‹•çš„ã«ã‚¢ã‚¤ãƒ†ãƒ ã¨ä¾¡æ ¼ã‚’æŠ½å‡º' }}</li>
                            <li>{{ 'Les articles sont associÃ©s intelligemment aux ingrÃ©dients du catalogue' if lang == 'fr' else 'ã‚¢ã‚¤ãƒ†ãƒ ãŒã‚«ã‚¿ãƒ­ã‚°ã®é£Ÿæã«ã‚¹ãƒãƒ¼ãƒˆã«é–¢é€£ä»˜ã‘ã‚‰ã‚Œã¾ã™' }}</li>
                            <li>{{ 'Vous validez les correspondances proposÃ©es' if lang == 'fr' else 'ææ¡ˆã•ã‚ŒãŸå¯¾å¿œã‚’ç¢ºèª' }}</li>
                            <li>{{ 'Les prix validÃ©s mettent Ã  jour votre catalogue automatiquement' if lang == 'fr' else 'ç¢ºèªã•ã‚ŒãŸä¾¡æ ¼ãŒã‚«ã‚¿ãƒ­ã‚°ã‚’è‡ªå‹•æ›´æ–°' }}</li>
                        </ol>
                    </div>

                    <!-- Boutons -->
                    <div class="flex justify-end gap-3">
                        <a href="/receipt-list?lang={{ lang }}"
                           class="px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700">
                            {{ 'Annuler' if lang == 'fr' else 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«' }}
                        </a>
                        <button type="submit"
                                :disabled="uploading"
                                class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2">
                            <span x-show="!uploading">ğŸ“¤ {{ 'Uploader et analyser' if lang == 'fr' else 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦åˆ†æ' }}</span>
                            <span x-show="uploading" class="flex items-center gap-2">
                                <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                {{ 'Analyse en cours...' if lang == 'fr' else 'åˆ†æä¸­...' }}
                            </span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Conseils -->
            <div class="mt-6 bg-gray-100 dark:bg-gray-800 rounded-lg p-4">
                <h3 class="font-semibold text-gray-900 dark:text-white mb-3">
                    ğŸ’¡ {{ 'Conseils pour de meilleurs rÃ©sultats' if lang == 'fr' else 'ã‚ˆã‚Šè‰¯ã„çµæœã‚’å¾—ã‚‹ãŸã‚ã®ãƒ’ãƒ³ãƒˆ' }}
                </h3>
                <ul class="text-sm text-gray-700 dark:text-gray-300 space-y-2">
                    <li class="flex gap-2">
                        <span>âœ“</span>
                        <span>{{ 'Assurez-vous que le PDF est lisible (pas d\'image scannÃ©e floue)' if lang == 'fr' else 'PDFãŒèª­ã¿ã‚„ã™ã„ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼ˆã¼ã‚„ã‘ãŸã‚¹ã‚­ãƒ£ãƒ³ç”»åƒã§ã¯ãªã„ï¼‰' }}</span>
                    </li>
                    <li class="flex gap-2">
                        <span>âœ“</span>
                        <span>{{ 'Les tickets de supermarchÃ©s et Ã©piceries donnent les meilleurs rÃ©sultats' if lang == 'fr' else 'ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒãƒ¼ã‚±ãƒƒãƒˆã‚„é£Ÿæ–™å“åº—ã®ãƒ¬ã‚·ãƒ¼ãƒˆãŒæœ€è‰¯ã®çµæœã‚’ã‚‚ãŸã‚‰ã—ã¾ã™' }}</span>
                    </li>
                    <li class="flex gap-2">
                        <span>âœ“</span>
                        <span>{{ 'VÃ©rifiez toujours les correspondances proposÃ©es avant de valider' if lang == 'fr' else 'ç¢ºèªã™ã‚‹å‰ã«å¿…ãšææ¡ˆã•ã‚ŒãŸå¯¾å¿œã‚’ç¢ºèªã—ã¦ãã ã•ã„' }}</span>
                    </li>
                </ul>
            </div>
        </main>
    </div>
</body>
</html>
